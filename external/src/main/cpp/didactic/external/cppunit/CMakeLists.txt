message ("Builidng APR in ${TARGET_BUILD_DIRECTORY}")
project(cppunit C CXX)

set(CPPUNIT_SOURCE_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/cppunit-1.14.0)
set(CPPUNIT_BUILD_DIRECTORY ${TARGET_BUILD_DIRECTORY}/cppunit-build)

set(CPPUNIT_INCLUDE_DIRECTORY ${CPPUNIT_SOURCE_DIRECTORY}/include/cppunit)

set(CPPUNIT_LIBS_DIRECTORY ${CPPUNIT_BUILD_DIRECTORY}/.libs)


file(MAKE_DIRECTORY
  ${CPPUNIT_BUILD_DIRECTORY}
)
set(CONFIGURE_FLAGS "")

configure_file(${CPPUNIT_SOURCE_DIRECTORY}/config-auto.h.in "${CPPUNIT_BUILD_DIRECTORY}/cppunit/config-auto.h")


add_custom_command(OUTPUT ${CPPUNIT_BUILD_DIRECTORY}/Makefile
    COMMAND CC=${CMAKE_C_COMPILER} ${CPPUNIT_SOURCE_DIRECTORY}/configure ${CONFIGURE_FLAGS}
    COMMAND ${CMAKE_COMMAND} -E copy include/apr.h ${CPPUNIT_SOURCE_DIRECTORY}/include
    WORKING_DIRECTORY ${APR_BUILD_DIRECTORY}
)

INSTALL( FILES ${CPPUNIT_BUILD_DIRECTORY}/cppunit-config  
         PERMISSIONS OWNER_EXECUTE OWNER_WRITE OWNER_READ    
         DESTINATION ${TARGET_BUILD_DIRECTORY}/bin
)

install(FILES "${CMAKE_CURRENT_BINARY_DIR}/cppunit/config-auto.h" 
         DESTINATION ${TARGET_BUILD_DIRECTORY}/include/cppunit)

install(DIRECTORY ${CPPUNIT_SOURCE_DIRECTORY}/include/cppunit
    DESTINATION ${TARGET_BUILD_DIRECTORY}/include
    FILES_MATCHING  PATTERN "*.h"
                    PATTERN "ui/qt" EXCLUDE
                    PATTERN "ui/mfc" EXCLUDE)